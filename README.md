# anti-autohome-series

针对汽车之家系列车型页面爬取数据时反爬虫策略。

仅供学习和参考。

## 核心攻破点

页面存在大量 CSS 伪元素文字，需要通过一定的手段还原。

经过页面分析发现，CSS 伪元素文字是页面内 JS 动态生成的。

获取到的网页源代码中，充斥着大量的类似 `<span class='hs_kw78_baikezG'></span>` 的文本，这是汽车之家做的一个简单的反爬虫策略。

对此，可以模拟 JS 执行环境，直接将执行的结果捞出来即可。

参数的表格也是动态生成的，数据来源也是直接在源代码中给出了，我们也一并将其捞出来即可。

## 代码部分说明

`extractText` 为临时编写的一个方法，用于提取指定字符串之间的文本。方法浅显易懂，不赘述。

`global.createElement` 和 `global.head` 为模拟方法，保证后面的 `eval` 方法执行的时候不出错。

`global.fake` 用来存放捞出来的关键替换数据。

`config` 和 `option` 两个参数是用来生成参数表格的核心数据，在浏览器的页面这两个变量是可以直接访问的。

## 文件保存

直接选用了 `node-xlsx` 库来保存到 Excel 文档。仅作学习参考，故此并未做任何处理。

## 执行

在 `node` 环境下，直接运行 `index.js` 文件即可。注意需要传入页面 ID。这里的 ID 指的是 URL 路径里面的数字。比如 `https://car.autohome.com.cn/config/series/4858.html` 这个页面，其 ID 就是 `4858`。执行 `node index --id 4858` 即可在 `excel` 目录下生成一个参数配置文件。

## 备注

`getHTML` 方法中用到了 `Promise`，故此需要 `node` 环境里面有该对象。

本文成文时间 2019 年 11 月 23 日，不保证该反爬手段持续有效。

*******

~~打完收工~~。
